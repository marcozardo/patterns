model *Kimmel2021_CARTcell_therapy()
  /*
   This model describes the interactions among normal T cells (N),
   chimeric antigen receptor (CAR) T cells (C), and tumor cells (B)
   following CAR T cell therapy. The dynamics are governed by a system
   of ordinary differential equations representing Gompertz growth for
   T cell populations and predator-prey-like interaction for tumor killing.
   The model is based on Kimmel et al. 2021, "The roles of T cell
   competition and stochastic extinction events in chimeric antigen
   receptor T cell therapy", Proc. R. Soc. B 288: 20210229.
  */

  //// Compartments and Species:
  compartment patient;
  species N in patient, C in patient, B in patient;

  //// Assignment Rules:
  # CAR T cell growth rate, dependent on total lymphocyte count T = N + C
  r_C := rho_C + (b*(N + C - K_N)^2) / (a*(N + C)^2 + (N + C - K_N)^2);

  //// Rate Rules:
  # Normal T cell dynamics, Gompertz growth
  N' = -r_N * N * log((N + C) / K_N);

  # CAR T cell dynamics, Gompertz growth with variable rate r_C
  C' = -r_C * C * log((N + C) / K_C);

  # Tumour cell dynamics, logistic growth and killing by CAR T cells
  B' = r_B * B - gamma_B * B * (C / (k_B + C));

  //// Species initializations:
  N = 3.00e9;   # initial median normal T cell number (cells)
  C = 1.80e8;   # initial CAR T cell number (cells)
  B = 9.486e10; # initial median tumour cell number (cells)

  //// Compartment initializations:
  patient = 1;  # unit volume, as model is in cell counts

  //// Variable initializations:
  K_N = 2.50e11;    # normal T cell carrying capacity (cells)
  K_C = 6.96e10;    # CAR T cell carrying capacity (cells)
  r_N = 1.70e-1;    # normal T cell net growth rate (day^-1)
  rho_C = 2.51e-2;  # baseline CAR T net growth rate (day^-1)
  a = 4.23e-1;      # signalling inefficiency factor in r_C (dimensionless)
  b = 5.25e-1;      # immune reconstitution impact in r_C (day^-1)
  r_B = 0.19;       # tumour net growth rate (day^-1), medium value from paper
  gamma_B = 1.15;   # tumour-killing rate (day^-1)
  k_B = 2.024e9;    # killing rate saturation parameter (cells)

  //// Other declarations:
  var r_C;
  const patient, K_N, K_C, r_N, rho_C, a, b, r_B, gamma_B, k_B;

  //// Unit definitions:
  unit time_unit = 86400 second;
  unit substance = 1 item;

  //// Display Names:
  time_unit is "day";
  substance is "cells";
  patient is "Patient";
  N is "Normal T cells";
  C is "CAR T cells";
  B is "Tumour cells";
  r_C is "CAR T cell growth rate function";
  K_N is "normal T cell carrying capacity";
  K_C is "CAR T cell carrying capacity";
  r_N is "normal T cell net growth rate";
  rho_C is "baseline CAR T net growth rate";
  a is "signalling inefficiency factor in r_C";
  b is "immune reconstitution impact in r_C";
  r_B is "tumour net growth rate";
  gamma_B is "tumour-killing rate (by effector CAR)";
  k_B is "killing rate saturation parameter";
end
