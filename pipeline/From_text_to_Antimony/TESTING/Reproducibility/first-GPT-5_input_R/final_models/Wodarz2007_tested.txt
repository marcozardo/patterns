model *Wodarz2007_HIV_CD4_Autocatalytic_Spread_with_CTL()

  //// Compartments and Species:
  compartment lymphoid;
  species T in lymphoid, I in lymphoid;                  
  species x in lymphoid, y in lymphoid;                  
  species v in lymphoid;                                 
  species w in lymphoid, z in lymphoid;                  
  species m0 in lymphoid, m1 in lymphoid, m2 in lymphoid, m3 in lymphoid, m4 in lymphoid;
  species m5 in lymphoid, m6 in lymphoid, m7 in lymphoid, m8 in lymphoid, m9 in lymphoid;  

  //// Assignment Rules:
  CTL_eff := z + w;           
  Xtot := x + y;              

  //// Rate Rules:
  # not present

  //// Reactions:
  Synthesis_T:          => T;            lymphoid*lambda;
  Death_T:             T  => ;           lymphoid*delta*T;
  Infection_T:         T  => I;          lymphoid*gamma_*T*v;
  Death_I:             I  => ;           lymphoid*alpha*I;
  CTL_kill_I:          I  => ;           lymphoid*p*CTL_eff*I;

  Prolif_x:             => x;            lymphoid*r*v*x*(1 - Xtot/k);
  Death_x:             x  => ;           lymphoid*d*x;
  Infection_x:         x  => y;          lymphoid*beta*x*v;

  Prolif_y:             => y;            lymphoid*r*v*y*(1 - Xtot/k);
  Death_y:             y  => ;           lymphoid*a*y;
  CTL_kill_y:          y  => ;           lymphoid*p*CTL_eff*y;

  Virus_prod:           => v;            lymphoid*eta*(y + I);
  Virus_clear:         v  => ;           lymphoid*u*v;

  Div_m0:             m0  => 2 m1;       lymphoid*rho*m0;
  Div_m1:             m1  => 2 m2;       lymphoid*rho*m1;
  Div_m2:             m2  => 2 m3;       lymphoid*rho*m2;
  Div_m3:             m3  => 2 m4;       lymphoid*rho*m3;
  Div_m4:             m4  => 2 m5;       lymphoid*rho*m4;
  Div_m5:             m5  => 2 m6;       lymphoid*rho*m5;
  Div_m6:             m6  => 2 m7;       lymphoid*rho*m6;
  Div_m7:             m7  => 2 m8;       lymphoid*rho*m7;
  Div_m8:             m8  => 2 m9;       lymphoid*rho*m8;
  Final_div_to_w:     m9  => 2 w;        lymphoid*rho*m9;

  Eff_death:          w   => ;           lymphoid*xi*w;
  Eff_to_mem:         w   => z;          lymphoid*phi*w;

  Z_expand:            => z;             lymphoid*c*x*(y + I)*z/(epsilon*x + 1);
  Z_death:            z   => ;           lymphoid*b*z;

  //// Events:
  # not present

  //// Species initializations:
  T  = lambda/delta;    
  I  = 1e-4;
  x  = 0.1;             
  y  = 0;
  v  = eta*I/u;         
  w  = 0;
  z  = 0;
  m0 = 0.1;
  m1 = 0; m2 = 0; m3 = 0; m4 = 0; m5 = 0; m6 = 0; m7 = 0; m8 = 0; m9 = 0;

  //// Compartment initializations:
  lymphoid = 1;

  //// Variable initializations:
  lambda = 1;
  r = 1;
  gamma_ = 0.01;
  beta = 0.2;
  delta = 0.01;
  alpha = 0.3;
  d = 0.001;
  a = 0.2;
  p = 45;
  c = 1;
  b = 0.1;
  k = 10;
  eta = 1;
  u = 1;
  phi = 1.5;
  xi = 0.01;
  rho = 1;
  epsilon = 1;

  //// Other declarations:
  var CTL_eff, Xtot;
  const lymphoid, lambda, r, gamma_, beta, delta, alpha, d, a, p, c, b, k, eta, u, phi, xi, rho, epsilon;

  //// Unit definitions:
  # not defined (time and amounts are arbitrary units per source)

  //// Display Names:
  lymphoid is "Host lymphoid/tissue compartment";
  T is "Susceptible non-specific target cells";
  I is "Infected non-specific target cells";
  x is "Uninfected HIV-specific CD4 T cells (functional helpers)";
  y is "Infected HIV-specific CD4 T cells (impaired helpers)";
  v is "Free virus";
  w is "CTL acute effector cells";
  z is "CTL effector/effector-memory pool";
  m0 is "Naive CTL after 0 divisions";
  m1 is "Naive CTL after 1 division";
  m2 is "Naive CTL after 2 divisions";
  m3 is "Naive CTL after 3 divisions";
  m4 is "Naive CTL after 4 divisions";
  m5 is "Naive CTL after 5 divisions";
  m6 is "Naive CTL after 6 divisions";
  m7 is "Naive CTL after 7 divisions";
  m8 is "Naive CTL after 8 divisions";
  m9 is "Naive CTL after 9 divisions";
end

/* Notes and source mapping:
- Scientific domain: viral immunodynamics at the cellular/organismal scale.
- Core equations implemented:
  Section 4 (Eq. 3): dT/dt = lambda - delta*T - gamma*T*v; dI/dt = gamma*T*v - alpha*I;
                     dx/dt = r*v*x*(1 - (x+y)/k) - d*x - beta*x*v;
                     dy/dt = beta*x*v + r*v*y*(1 - (x+y)/k) - a*y;
                     dv/dt = eta*(y+I) - u*v.
  Section 6 (Eq. 4): Programmed CTL proliferation m0..m9 -> w with rates rho;
                     dw/dt = 2*rho*m9 - xi*w - phi*w.
  Section 6 (Eq. 5): dz/dt = phi*w + c*x*(y+I)*z/(epsilon*x + 1) - b*z.
  CTL-mediated lysis terms: added -p*y*(z+w) and -p*I*(z+w).

- Data unification choices:
  ? Used a single proliferation rate r for both x and y, consistent with figures parameter sets.
  ? Included x and y factors in their own antigen-driven proliferation terms (per-capita growth r*v*(1 - (x+y)/k) times the cell?s abundance), consistent with Section 2 and text descriptions of density dependence.
  ? Parameter set drawn coherently from Figure 3 (i): lambda=1, r=1, gamma=0.01, beta=0.2, delta=0.01, alpha=0.3, d=0.001, a=0.2, p=45, c=1, b=0.1, k=10, eta=1, u=1, phi=1.5, xi=0.01, rho=1, epsilon=1.
  ? Initial conditions follow text: T0=lambda/delta; I0=1e-4; v0=eta*I0/u; x0=0.1 (chosen low-initial-help scenario); y0=0; w0=z0=0; m0=0.1, m1..m9=0.

- Therapy scenario (Section 7): During treatment gamma=beta=0. No event is included here due to unspecified timing; this can be emulated by setting gamma and beta to ~0 via a simulator event at the desired start time.

- Ambiguity note: The printed dx/dt term in Eq. (3) omits the factor x in the rxv(1 - (x+y)/k) term and the multiplier on d; we implemented the biologically consistent form rx*v*x*(1 - (x+y)/k) - d*x - beta*x*v, matching the text that uninfected cells proliferate and die proportionally to their abundance with density dependence. */
