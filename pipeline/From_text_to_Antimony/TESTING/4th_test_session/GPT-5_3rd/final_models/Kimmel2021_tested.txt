/* Domain: Physiological/clinical systems immunology (cell population dynamics in CAR T therapy)
Source: Kimmel GJ, Locke FL, Altrock PM. Proc. R. Soc. B (2021) 288:20210229.
Deterministic mean-field model using Gompertz growth for T cells with CAR?tumor interaction and saturating killing.
Equations (2.1)?(2.3); parameterization from Table 1 and figure text. */

model *Kimmel2021_CART_Gompertz()

  //// Compartments and Species:
  compartment system;
  species N in system, C in system, B in system;

  //// Assignment Rules:
  T := N + C;  // total lymphocyte count
  rC_T := rho_C + b*(T - K_N)^2/(a*T^2 + (T - K_N)^2);  // turnover rate of CAR T cells as function of total T

  //// Rate Rules:
  N' = - r_N*N*ln((N + C)/K_N);
  C' = - rC_T*C*ln((N + C)/K_C);
  B' = r_B*B - gamma_B*B*(C/(k_B + C));

  //// Reactions:
  // not present

  //// Events:
  // not present

  //// Species initializations:
  N = 3.0e9;        // initial median normal T cell number (cells)
  C = 1.8e8;        // initial CAR T cell number (cells)
  B = 9.486e10;     // initial median tumor cell number (cells)

  //// Compartment initializations:
  system = 1;

  //// Variable initializations:
  K_N = 2.50e11;    // normal T cell carrying capacity (cells)
  K_C = 6.96e10;    // CAR T cell carrying capacity (cells)
  r_N = 1.70e-1;    // normal T net growth rate (1/day)
  rho_C = 2.51e-2;  // baseline CAR T net growth rate (1/day)
  a = 4.23e-1;      // signaling inefficiency factor in r_C (dimensionless)
  b = 5.25e-1;      // immune reconstitution impact in r_C (1/day)
  r_B = 1.90e-1;    // tumor net growth rate (1/day) ? medium scenario from Fig. 3b
  gamma_B = 1.15;   // tumor-killing rate by CAR T (1/day)
  k_B = 2.024e9;    // killing saturation parameter (cells)

  //// Other declarations:
  var T, rC_T;
  const system, K_N, K_C, r_N, rho_C, a, b, r_B, gamma_B, k_B;

  //// Unit definitions:
  // omitted (dimensionless counts; rates per day)

  //// Display Names:
  system is "System (normalized volume)";
  N is "Normal T cells";
  C is "CAR T cells";
  B is "CD19+ tumor cells";
  T is "Total T cells";
  rC_T is "CAR T turnover rate r_C(T)";
  K_N is "Normal T carrying capacity";
  K_C is "CAR T carrying capacity";
  r_N is "Normal T net growth rate";
  rho_C is "Baseline CAR T net growth rate";
  a is "Signaling inefficiency factor (r_C)";
  b is "Immune reconstitution impact (r_C)";
  r_B is "Tumor net growth rate";
  gamma_B is "Tumor killing rate by CAR T";
  k_B is "Killing saturation parameter";
end

/* Unmapped/standardized choices:
- Tumor net growth rate r_B was provided as a range (1?50)?10^-2 day^-1 in Table 1. We selected r_B = 0.19 day^-1 to match the ?medium? intrinsic growth used in Fig. 3b for a single coherent deterministic model. Users may adjust r_B to explore slow/fast tumor scenarios (e.g., 0.105 or 0.265 day^-1).
- Units: The paper reports both concentrations and counts; Table 1 provides counts. This model uses absolute cell counts and per-day rates; compartment volume is normalized to 1. */
